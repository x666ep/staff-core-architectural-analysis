<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="426px" preserveAspectRatio="none" style="width:444px;height:426px;background:#FFFFFF;" version="1.1" viewBox="0 0 444 426" width="444px" zoomAndPan="magnify"><defs/><g><ellipse cx="225.5" cy="20" fill="#222222" rx="10" ry="10" style="stroke:#222222;stroke-width:1.0;"/><rect fill="#F1F1F1" height="48.2656" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="254" x="98.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="234" x="108.5" y="71.6016">Выбираем из account_last_changes_raw</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="174" x="108.5" y="85.7344">необработанные изменения</text><rect fill="#F1F1F1" height="34.1328" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="182" x="134.5" y="162.2656"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="162" x="144.5" y="183.8672">делаем UPSERT данных УЗ</text><rect fill="#F1F1F1" height="34.1328" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="361" x="45" y="216.3984"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="341" x="55" y="238">подготавливаем ивент/ивенты для внутреннего топика</text><rect fill="#F1F1F1" height="48.2656" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="326" x="62.5" y="275.8984"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="306" x="72.5" y="297.5">кладем наши события в табличку employee_events</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="208" x="72.5" y="311.6328">для дальнейшей отправки в kafka</text><rect fill="#F1F1F1" height="48.2656" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="244" x="103.5" y="344.1641"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="212" x="113.5" y="365.7656">помечаем что состояние в таблице</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="224" x="113.5" y="379.8984">account_last_changes_raw применено</text><polygon fill="#F1F1F1" points="117,118.2656,334,118.2656,346,130.2656,334,142.2656,117,142.2656,105,130.2656,117,118.2656" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="217" x="117" y="134.4229">Перебираем в цикле массив изменений</text><ellipse cx="24" cy="173.2656" fill="none" rx="11" ry="11" style="stroke:#222222;stroke-width:1.0;"/><ellipse cx="24" cy="173.2656" fill="#222222" rx="6" ry="6" style="stroke:#111111;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="225.5" x2="225.5" y1="30" y2="50"/><polygon fill="#181818" points="221.5,40,225.5,50,229.5,40,225.5,44" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="225.5" x2="225.5" y1="196.3984" y2="216.3984"/><polygon fill="#181818" points="221.5,206.3984,225.5,216.3984,229.5,206.3984,225.5,210.3984" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="225.5" x2="225.5" y1="250.5313" y2="275.8984"/><polygon fill="#181818" points="221.5,265.8984,225.5,275.8984,229.5,265.8984,225.5,269.8984" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="225.5" x2="225.5" y1="324.1641" y2="344.1641"/><polygon fill="#181818" points="221.5,334.1641,225.5,344.1641,229.5,334.1641,225.5,338.1641" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="225.5" x2="225.5" y1="142.2656" y2="162.2656"/><polygon fill="#181818" points="221.5,152.2656,225.5,162.2656,229.5,152.2656,225.5,156.2656" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="225.5" x2="225.5" y1="392.4297" y2="402.4297"/><line style="stroke:#181818;stroke-width:1.0;" x1="225.5" x2="418" y1="402.4297" y2="402.4297"/><polygon fill="#181818" points="414,270.5313,418,260.5313,422,270.5313,418,266.5313" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="418" x2="418" y1="130.2656" y2="402.4297"/><line style="stroke:#181818;stroke-width:1.0;" x1="418" x2="346" y1="130.2656" y2="130.2656"/><polygon fill="#181818" points="356,126.2656,346,130.2656,356,134.2656,352,130.2656" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="105" x2="24" y1="130.2656" y2="130.2656"/><line style="stroke:#181818;stroke-width:1.0;" x1="24" x2="24" y1="130.2656" y2="162.2656"/><polygon fill="#181818" points="20,152.2656,24,162.2656,28,152.2656,24,156.2656" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="225.5" x2="225.5" y1="98.2656" y2="118.2656"/><polygon fill="#181818" points="221.5,108.2656,225.5,118.2656,229.5,108.2656,225.5,112.2656" style="stroke:#181818;stroke-width:1.0;"/><!--MD5=[e5e3ed9247173bedb8ac3ea4fa526720]
@startuml ProcessAccountChanges
skinparam ConditionEndStyle hline 
scale max 500 height
    start
        :Выбираем из account_last_changes_raw
        необработанные изменения;
        while (Перебираем в цикле массив изменений)
            :делаем UPSERT данных УЗ;
            :подготавливаем ивент/ивенты для внутреннего топика;
            :кладем наши события в табличку employee_events
            для дальнейшей отправки в kafka;
            :помечаем что состояние в таблице 
            account_last_changes_raw применено;
        endwhile
    stop
@enduml

PlantUML version 1.2022.7(Mon Aug 22 20:01:30 MSK 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: RU
--></g></svg>