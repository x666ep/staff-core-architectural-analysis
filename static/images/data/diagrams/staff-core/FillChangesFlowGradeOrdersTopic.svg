<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="490px" preserveAspectRatio="none" style="width:1360px;height:490px;background:#FFFFFF;" version="1.1" viewBox="0 0 1360 490" width="1360px" zoomAndPan="magnify"><defs/><g><ellipse cx="803.375" cy="20" fill="#222222" rx="10" ry="10" style="stroke:#222222;stroke-width:1.0;"/><rect fill="#F1F1F1" height="34.1328" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="192" x="707.375" y="50"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="172" x="717.375" y="71.6016">Получаем событие из кафки</text><rect fill="#F1F1F1" height="34.1328" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="393" x="606.875" y="104.1328"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="373" x="616.875" y="125.7344">Сохраняем в таблицу employee_grade_change_documents_raw</text><rect fill="#F1F1F1" height="48.2656" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="420" x="593.375" y="158.2656"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="400" x="603.375" y="179.8672">Запрашиваем из таблицы employee_grade_change_documents_raw</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="185" x="603.375" y="194">приказы с тем-же documentID</text><polygon fill="#F1F1F1" points="698.875,226.5313,907.875,226.5313,919.875,238.5313,907.875,250.5313,698.875,250.5313,686.875,238.5313,698.875,226.5313" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="209" x="698.875" y="242.6885">Есть документ с таким-же documentId</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="668.875" y="236.2109">yes</text><polygon fill="#F1F1F1" points="359.25,260.5313,567.25,260.5313,579.25,272.5313,567.25,284.5313,359.25,284.5313,347.25,272.5313,359.25,260.5313" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="208" x="359.25" y="276.6885">его version != прилетевшего из кафки</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="329.25" y="270.2109">yes</text><rect fill="#F1F1F1" height="34.1328" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="435" x="11" y="343.0088"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="415" x="21" y="364.6104">удаляем этот документ из employee_grade_change_documents_actual</text><polygon fill="#F1F1F1" points="152,294.5313,305,294.5313,317,306.5313,305,318.5313,152,318.5313,140,306.5313,152,294.5313" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="232.5" y="329.166">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="153" x="152" y="310.6885">Это отмена или распровод?</text><rect fill="#F1F1F1" height="48.2656" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="420" x="488" y="294.5313"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="400" x="498" y="316.1328">обновляем в значения в employee_grade_change_documents_actual</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="276" x="498" y="330.2656">и устанавливаем version документа из кафки</text><rect fill="#F1F1F1" height="48.2656" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="411" x="938" y="260.5313"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="391" x="948" y="282.1328">создаем новую строку employee_grade_change_documents_actual</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="219" x="948" y="296.2656">со значениями документа из кафки</text><ellipse cx="803.375" cy="468.1416" fill="none" rx="11" ry="11" style="stroke:#222222;stroke-width:1.0;"/><ellipse cx="803.375" cy="468.1416" fill="#222222" rx="6" ry="6" style="stroke:#111111;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="803.375" x2="803.375" y1="30" y2="50"/><polygon fill="#181818" points="799.375,40,803.375,50,807.375,40,803.375,44" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="803.375" x2="803.375" y1="84.1328" y2="104.1328"/><polygon fill="#181818" points="799.375,94.1328,803.375,104.1328,807.375,94.1328,803.375,98.1328" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="803.375" x2="803.375" y1="138.2656" y2="158.2656"/><polygon fill="#181818" points="799.375,148.2656,803.375,158.2656,807.375,148.2656,803.375,152.2656" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="228.5" x2="228.5" y1="318.5313" y2="343.0088"/><polygon fill="#181818" points="224.5,333.0088,228.5,343.0088,232.5,333.0088,228.5,337.0088" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="317" x2="456" y1="306.5313" y2="306.5313"/><line style="stroke:#181818;stroke-width:1.0;" x1="456" x2="456" y1="306.5313" y2="399.1416"/><polygon fill="#181818" points="452,389.1416,456,399.1416,460,389.1416,456,393.1416" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="456" x2="228.5" y1="399.1416" y2="399.1416"/><line style="stroke:#181818;stroke-width:1.0;" x1="228.5" x2="228.5" y1="399.1416" y2="404.1416"/><line style="stroke:#181818;stroke-width:1.0;" x1="228.5" x2="228.5" y1="377.1416" y2="399.1416"/><polygon fill="#181818" points="224.5,389.1416,228.5,399.1416,232.5,389.1416,228.5,393.1416" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="347.25" x2="228.5" y1="272.5313" y2="272.5313"/><line style="stroke:#181818;stroke-width:1.0;" x1="228.5" x2="228.5" y1="272.5313" y2="294.5313"/><polygon fill="#181818" points="224.5,284.5313,228.5,294.5313,232.5,284.5313,228.5,288.5313" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="579.25" x2="698" y1="272.5313" y2="272.5313"/><line style="stroke:#181818;stroke-width:1.0;" x1="698" x2="698" y1="272.5313" y2="294.5313"/><polygon fill="#181818" points="694,284.5313,698,294.5313,702,284.5313,698,288.5313" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="228.5" x2="228.5" y1="404.1416" y2="419.1416"/><polygon fill="#181818" points="224.5,409.1416,228.5,419.1416,232.5,409.1416,228.5,413.1416" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="698" x2="698" y1="342.7969" y2="419.1416"/><polygon fill="#181818" points="694,409.1416,698,419.1416,702,409.1416,698,413.1416" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="228.5" x2="698" y1="419.1416" y2="419.1416"/><line style="stroke:#181818;stroke-width:1.0;" x1="686.875" x2="463.25" y1="238.5313" y2="238.5313"/><line style="stroke:#181818;stroke-width:1.0;" x1="463.25" x2="463.25" y1="238.5313" y2="260.5313"/><polygon fill="#181818" points="459.25,250.5313,463.25,260.5313,467.25,250.5313,463.25,254.5313" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="919.875" x2="1143.5" y1="238.5313" y2="238.5313"/><line style="stroke:#181818;stroke-width:1.0;" x1="1143.5" x2="1143.5" y1="238.5313" y2="260.5313"/><polygon fill="#181818" points="1139.5,250.5313,1143.5,260.5313,1147.5,250.5313,1143.5,254.5313" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="463.25" x2="463.25" y1="419.1416" y2="437.1416"/><polygon fill="#181818" points="459.25,427.1416,463.25,437.1416,467.25,427.1416,463.25,431.1416" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1143.5" x2="1143.5" y1="308.7969" y2="437.1416"/><polygon fill="#181818" points="1139.5,427.1416,1143.5,437.1416,1147.5,427.1416,1143.5,431.1416" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="463.25" x2="1143.5" y1="437.1416" y2="437.1416"/><line style="stroke:#181818;stroke-width:1.0;" x1="803.375" x2="803.375" y1="206.5313" y2="226.5313"/><polygon fill="#181818" points="799.375,216.5313,803.375,226.5313,807.375,216.5313,803.375,220.5313" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="803.375" x2="803.375" y1="437.1416" y2="457.1416"/><polygon fill="#181818" points="799.375,447.1416,803.375,457.1416,807.375,447.1416,803.375,451.1416" style="stroke:#181818;stroke-width:1.0;"/><!--MD5=[1a835c32ac2824e0d6724ae232d07b29]
@startuml FillChangesFlowGradeOrdersTopic
skinparam ConditionEndStyle hline 
scale max 500 height
    start
        :Получаем событие из кафки;
        :Сохраняем в таблицу employee_grade_change_documents_raw;
        :Запрашиваем из таблицы employee_grade_change_documents_raw 
        приказы с тем-же documentID;

        if (Есть документ с таким-же documentId) then (yes)
            if (его version != прилетевшего из кафки) then (yes) 
                if (Это отмена или распровод?) then (yes)
                    :удаляем этот документ из employee_grade_change_documents_actual;
                endif
            else
            :обновляем в значения в employee_grade_change_documents_actual
            и устанавливаем version документа из кафки;
            endif
            else
            :создаем новую строку employee_grade_change_documents_actual
            со значениями документа из кафки;
        endif
    stop
@enduml

PlantUML version 1.2022.7(Mon Aug 22 20:01:30 MSK 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: RU
--></g></svg>