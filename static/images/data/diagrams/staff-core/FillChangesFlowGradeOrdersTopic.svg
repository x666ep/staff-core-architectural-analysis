<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="483px" preserveAspectRatio="none" style="width:1502px;height:483px;background:#FFFFFF;" version="1.1" viewBox="0 0 1502 483" width="1502px" zoomAndPan="magnify"><defs/><g><ellipse cx="1001.5625" cy="20" fill="#222222" rx="10" ry="10" style="stroke:#222222;stroke-width:1.0;"/><rect fill="#F1F1F1" height="34.1328" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="192" x="905.5625" y="50"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="172" x="915.5625" y="71.6016">Получаем событие из кафки</text><rect fill="#F1F1F1" height="34.1328" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="393" x="805.0625" y="104.1328"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="373" x="815.0625" y="125.7344">Сохраняем в таблицу employee_grade_change_documents_raw</text><rect fill="#F1F1F1" height="48.2656" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="420" x="791.5625" y="158.2656"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="400" x="801.5625" y="179.8672">Запрашиваем из таблицы employee_grade_change_documents_raw</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="185" x="801.5625" y="194">приказы с тем-же documentID</text><polygon fill="#F1F1F1" points="897.0625,226.5313,1106.0625,226.5313,1118.0625,238.5313,1106.0625,250.5313,897.0625,250.5313,885.0625,238.5313,897.0625,226.5313" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="209" x="897.0625" y="242.6885">Есть документ с таким-же documentId</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="867.0625" y="236.2109">yes</text><polygon fill="#F1F1F1" points="615.125,260.5313,820.125,260.5313,832.125,272.5313,820.125,284.5313,615.125,284.5313,603.125,272.5313,615.125,260.5313" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="205" x="615.125" y="276.6885">его version &lt; прилетевшего из кафки</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="585.125" y="270.2109">yes</text><polygon fill="#F1F1F1" points="375.75,294.5313,528.75,294.5313,540.75,306.5313,528.75,318.5313,375.75,318.5313,363.75,306.5313,375.75,294.5313" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="153" x="375.75" y="310.6885">Это отмена или распровод?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="345.75" y="304.2109">yes</text><rect fill="#F1F1F1" height="34.1328" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="435" x="11" y="328.5313"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="415" x="21" y="350.1328">удаляем этот документ из employee_grade_change_documents_actual</text><rect fill="#F1F1F1" height="48.2656" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="420" x="466" y="328.5313"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="400" x="476" y="350.1328">обновляем в значения в employee_grade_change_documents_actual</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="276" x="476" y="364.2656">и устанавливаем version документа из кафки</text><rect fill="#F1F1F1" height="34.1328" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="134" x="916" y="294.5313"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="114" x="926" y="316.1328">скипаем документ</text><rect fill="#F1F1F1" height="48.2656" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="411" x="1080" y="260.5313"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="391" x="1090" y="282.1328">создаем новую строку employee_grade_change_documents_actual</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="219" x="1090" y="296.2656">со значениями документа из кафки</text><ellipse cx="1001.5625" cy="461.7969" fill="none" rx="11" ry="11" style="stroke:#222222;stroke-width:1.0;"/><ellipse cx="1001.5625" cy="461.7969" fill="#222222" rx="6" ry="6" style="stroke:#111111;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1001.5625" x2="1001.5625" y1="30" y2="50"/><polygon fill="#181818" points="997.5625,40,1001.5625,50,1005.5625,40,1001.5625,44" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1001.5625" x2="1001.5625" y1="84.1328" y2="104.1328"/><polygon fill="#181818" points="997.5625,94.1328,1001.5625,104.1328,1005.5625,94.1328,1001.5625,98.1328" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1001.5625" x2="1001.5625" y1="138.2656" y2="158.2656"/><polygon fill="#181818" points="997.5625,148.2656,1001.5625,158.2656,1005.5625,148.2656,1001.5625,152.2656" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="363.75" x2="228.5" y1="306.5313" y2="306.5313"/><line style="stroke:#181818;stroke-width:1.0;" x1="228.5" x2="228.5" y1="306.5313" y2="328.5313"/><polygon fill="#181818" points="224.5,318.5313,228.5,328.5313,232.5,318.5313,228.5,322.5313" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="540.75" x2="676" y1="306.5313" y2="306.5313"/><line style="stroke:#181818;stroke-width:1.0;" x1="676" x2="676" y1="306.5313" y2="328.5313"/><polygon fill="#181818" points="672,318.5313,676,328.5313,680,318.5313,676,322.5313" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="228.5" x2="228.5" y1="362.6641" y2="394.7969"/><polygon fill="#181818" points="224.5,384.7969,228.5,394.7969,232.5,384.7969,228.5,388.7969" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="676" x2="676" y1="376.7969" y2="394.7969"/><polygon fill="#181818" points="672,384.7969,676,394.7969,680,384.7969,676,388.7969" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="228.5" x2="676" y1="394.7969" y2="394.7969"/><line style="stroke:#181818;stroke-width:1.0;" x1="603.125" x2="452.25" y1="272.5313" y2="272.5313"/><line style="stroke:#181818;stroke-width:1.0;" x1="452.25" x2="452.25" y1="272.5313" y2="294.5313"/><polygon fill="#181818" points="448.25,284.5313,452.25,294.5313,456.25,284.5313,452.25,288.5313" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="832.125" x2="983" y1="272.5313" y2="272.5313"/><line style="stroke:#181818;stroke-width:1.0;" x1="983" x2="983" y1="272.5313" y2="294.5313"/><polygon fill="#181818" points="979,284.5313,983,294.5313,987,284.5313,983,288.5313" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="452.25" x2="452.25" y1="394.7969" y2="412.7969"/><polygon fill="#181818" points="448.25,402.7969,452.25,412.7969,456.25,402.7969,452.25,406.7969" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="983" x2="983" y1="328.6641" y2="412.7969"/><polygon fill="#181818" points="979,402.7969,983,412.7969,987,402.7969,983,406.7969" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="452.25" x2="983" y1="412.7969" y2="412.7969"/><line style="stroke:#181818;stroke-width:1.0;" x1="885.0625" x2="717.625" y1="238.5313" y2="238.5313"/><line style="stroke:#181818;stroke-width:1.0;" x1="717.625" x2="717.625" y1="238.5313" y2="260.5313"/><polygon fill="#181818" points="713.625,250.5313,717.625,260.5313,721.625,250.5313,717.625,254.5313" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1118.0625" x2="1285.5" y1="238.5313" y2="238.5313"/><line style="stroke:#181818;stroke-width:1.0;" x1="1285.5" x2="1285.5" y1="238.5313" y2="260.5313"/><polygon fill="#181818" points="1281.5,250.5313,1285.5,260.5313,1289.5,250.5313,1285.5,254.5313" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="717.625" x2="717.625" y1="412.7969" y2="430.7969"/><polygon fill="#181818" points="713.625,420.7969,717.625,430.7969,721.625,420.7969,717.625,424.7969" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1285.5" x2="1285.5" y1="308.7969" y2="430.7969"/><polygon fill="#181818" points="1281.5,420.7969,1285.5,430.7969,1289.5,420.7969,1285.5,424.7969" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="717.625" x2="1285.5" y1="430.7969" y2="430.7969"/><line style="stroke:#181818;stroke-width:1.0;" x1="1001.5625" x2="1001.5625" y1="206.5313" y2="226.5313"/><polygon fill="#181818" points="997.5625,216.5313,1001.5625,226.5313,1005.5625,216.5313,1001.5625,220.5313" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1001.5625" x2="1001.5625" y1="430.7969" y2="450.7969"/><polygon fill="#181818" points="997.5625,440.7969,1001.5625,450.7969,1005.5625,440.7969,1001.5625,444.7969" style="stroke:#181818;stroke-width:1.0;"/><!--MD5=[f51aecfff4618f529af97fb86bb3e521]
@startuml FillChangesFlowGradeOrdersTopic
skinparam ConditionEndStyle hline 
scale max 500 height
    start
        :Получаем событие из кафки;
        :Сохраняем в таблицу employee_grade_change_documents_raw;
        :Запрашиваем из таблицы employee_grade_change_documents_raw 
        приказы с тем-же documentID;

        if (Есть документ с таким-же documentId) then (yes)
            if (его version < прилетевшего из кафки) then (yes) 

                if (Это отмена или распровод?) then (yes)
                    :удаляем этот документ из employee_grade_change_documents_actual;
                    else
                    :обновляем в значения в employee_grade_change_documents_actual
                    и устанавливаем version документа из кафки;
                endif
            else
            :скипаем документ;
            endif
            else
            :создаем новую строку employee_grade_change_documents_actual
            со значениями документа из кафки;
        endif
    stop
@enduml

PlantUML version 1.2022.7(Mon Aug 22 20:01:30 MSK 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: RU
--></g></svg>