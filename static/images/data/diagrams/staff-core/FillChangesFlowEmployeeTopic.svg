<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="500.5938px" preserveAspectRatio="none" style="width:583px;height:500px;background:#FFFFFF;" version="1.1" viewBox="0 0 583 500" width="583.4044px" zoomAndPan="magnify"><defs/><g><ellipse cx="291.7022" cy="14.9208" fill="#222222" rx="7.4604" ry="7.4604" style="stroke:#222222;stroke-width:0.7460413907260643;"/><rect fill="#F1F1F1" height="25.4645" rx="9.3255" ry="9.3255" style="stroke:#181818;stroke-width:0.3730206953630322;" width="143.2399" x="220.0822" y="37.3021"/><text fill="#000000" font-family="sans-serif" font-size="8.9525" lengthAdjust="spacing" textLength="128.3191" x="227.5426" y="53.4177">Получаем событие из кафки</text><rect fill="#F1F1F1" height="36.0082" rx="9.3255" ry="9.3255" style="stroke:#181818;stroke-width:0.3730206953630322;" width="214.8599" x="184.2722" y="77.6874"/><text fill="#000000" font-family="sans-serif" font-size="8.9525" lengthAdjust="spacing" textLength="199.9391" x="191.7326" y="93.803">Запрашиваем из БД предыдущее состояние</text><text fill="#000000" font-family="sans-serif" font-size="8.9525" lengthAdjust="spacing" textLength="176.0658" x="191.7326" y="104.3467">из таблицы employee_last_changes_raw</text><polygon fill="#F1F1F1" points="233.1379,128.6164,350.2664,128.6164,359.2189,137.5689,350.2664,146.5214,233.1379,146.5214,224.1854,137.5689,233.1379,128.6164" style="stroke:#181818;stroke-width:0.3730206953630322;"/><text fill="#000000" font-family="sans-serif" font-size="8.2065" lengthAdjust="spacing" textLength="117.1285" x="233.1379" y="140.6703">Предыдущее состояние есть</text><text fill="#000000" font-family="sans-serif" font-size="8.2065" lengthAdjust="spacing" textLength="13.4287" x="210.7567" y="135.8378">yes</text><rect fill="#F1F1F1" height="57.0955" rx="9.3255" ry="9.3255" style="stroke:#181818;stroke-width:0.3730206953630322;" width="206.6535" x="38.7942" y="153.9818"/><text fill="#000000" font-family="sans-serif" font-size="8.9525" lengthAdjust="spacing" textLength="191.7326" x="46.2546" y="170.0974">создаем обьект с полями prev_data и data</text><text fill="#000000" font-family="sans-serif" font-size="8.9525" lengthAdjust="spacing" textLength="141.7479" x="46.2546" y="180.6411">наполняем prev_data данными</text><text fill="#000000" font-family="sans-serif" font-size="8.9525" lengthAdjust="spacing" textLength="165.6212" x="46.2546" y="191.1848">из поля data предыдущего сотояния</text><text fill="#000000" font-family="sans-serif" font-size="8.9525" lengthAdjust="spacing" textLength="185.7643" x="46.2546" y="201.7284">а data наполняется данными из события</text><rect fill="#F1F1F1" height="25.4645" rx="9.3255" ry="9.3255" style="stroke:#181818;stroke-width:0.3730206953630322;" width="196.2089" x="44.0164" y="236.5417"/><text fill="#000000" font-family="sans-serif" font-size="8.9525" lengthAdjust="spacing" textLength="181.2881" x="51.4769" y="252.6574">построчно сравниваем prev_data и data</text><rect fill="#F1F1F1" height="25.4645" rx="9.3255" ry="9.3255" style="stroke:#181818;stroke-width:0.3730206953630322;" width="85.0487" x="99.5965" y="313.0933"/><text fill="#000000" font-family="sans-serif" font-size="8.9525" lengthAdjust="spacing" textLength="70.1279" x="107.0569" y="329.209">формируем diff</text><rect fill="#F1F1F1" height="25.4645" rx="9.3255" ry="9.3255" style="stroke:#181818;stroke-width:0.3730206953630322;" width="217.8441" x="33.1988" y="353.4786"/><text fill="#000000" font-family="sans-serif" font-size="8.9525" lengthAdjust="spacing" textLength="202.9233" x="40.6593" y="369.5943">кладем его в таблицу employee_changes_raw</text><rect fill="#F1F1F1" height="36.0082" rx="9.3255" ry="9.3255" style="stroke:#181818;stroke-width:0.3730206953630322;" width="267.8289" x="8.2065" y="393.864"/><text fill="#000000" font-family="sans-serif" font-size="8.9525" lengthAdjust="spacing" textLength="252.908" x="15.6669" y="409.9796">объект сохраняем в таблицу employee_last_changes_raw</text><text fill="#000000" font-family="sans-serif" font-size="8.9525" lengthAdjust="spacing" textLength="152.9385" x="15.6669" y="420.5233">с пометкой events_created = false</text><polygon fill="#F1F1F1" points="125.335,276.9271,158.9068,276.9271,167.8593,285.8796,158.9068,294.8321,125.335,294.8321,116.3825,285.8796,125.335,276.9271" style="stroke:#181818;stroke-width:0.3730206953630322;"/><text fill="#000000" font-family="sans-serif" font-size="8.2065" lengthAdjust="spacing" textLength="13.4287" x="145.1051" y="302.766">yes</text><text fill="#000000" font-family="sans-serif" font-size="8.2065" lengthAdjust="spacing" textLength="33.5719" x="125.335" y="288.981">Есть Diff</text><rect fill="#F1F1F1" height="46.5518" rx="9.3255" ry="9.3255" style="stroke:#181818;stroke-width:0.3730206953630322;" width="206.6535" x="337.9567" y="153.9818"/><text fill="#000000" font-family="sans-serif" font-size="8.9525" lengthAdjust="spacing" textLength="191.7326" x="345.4172" y="170.0974">создаем обьект с полями prev_data и data</text><text fill="#000000" font-family="sans-serif" font-size="8.9525" lengthAdjust="spacing" textLength="107.43" x="345.4172" y="180.6411">prev_data будет пустым</text><text fill="#000000" font-family="sans-serif" font-size="8.9525" lengthAdjust="spacing" textLength="185.7643" x="345.4172" y="191.1848">а data наполняется данными из события</text><rect fill="#F1F1F1" height="36.0082" rx="9.3255" ry="9.3255" style="stroke:#181818;stroke-width:0.3730206953630322;" width="239.4793" x="321.5438" y="225.9981"/><text fill="#000000" font-family="sans-serif" font-size="8.9525" lengthAdjust="spacing" textLength="205.9074" x="329.0043" y="242.1137">записываем в таблицу employee_changes_raw</text><text fill="#000000" font-family="sans-serif" font-size="8.9525" lengthAdjust="spacing" textLength="224.5585" x="329.0043" y="252.6574">новую строчку с полной информацией из ивента</text><rect fill="#F1F1F1" height="36.0082" rx="9.3255" ry="9.3255" style="stroke:#181818;stroke-width:0.3730206953630322;" width="267.8289" x="307.3691" y="276.9271"/><text fill="#000000" font-family="sans-serif" font-size="8.9525" lengthAdjust="spacing" textLength="252.908" x="314.8295" y="293.0427">объект сохраняем в таблицу employee_last_changes_raw</text><text fill="#000000" font-family="sans-serif" font-size="8.9525" lengthAdjust="spacing" textLength="152.9385" x="314.8295" y="303.5864">с пометкой events_created = false</text><ellipse cx="291.7022" cy="484.3331" fill="none" rx="8.2065" ry="8.2065" style="stroke:#222222;stroke-width:0.7460413907260643;"/><ellipse cx="291.7022" cy="484.3331" fill="#222222" rx="4.4762" ry="4.4762" style="stroke:#111111;stroke-width:0.7460413907260643;"/><line style="stroke:#181818;stroke-width:0.7460413907260643;" x1="291.7022" x2="291.7022" y1="22.3812" y2="37.3021"/><polygon fill="#181818" points="288.718,29.8417,291.7022,37.3021,294.6863,29.8417,291.7022,32.8258" style="stroke:#181818;stroke-width:0.7460413907260643;"/><line style="stroke:#181818;stroke-width:0.7460413907260643;" x1="291.7022" x2="291.7022" y1="62.7666" y2="77.6874"/><polygon fill="#181818" points="288.718,70.227,291.7022,77.6874,294.6863,70.227,291.7022,73.2111" style="stroke:#181818;stroke-width:0.7460413907260643;"/><line style="stroke:#181818;stroke-width:0.7460413907260643;" x1="142.1209" x2="142.1209" y1="211.0773" y2="236.5417"/><polygon fill="#181818" points="139.1367,229.0813,142.1209,236.5417,145.1051,229.0813,142.1209,232.0655" style="stroke:#181818;stroke-width:0.7460413907260643;"/><line style="stroke:#181818;stroke-width:0.7460413907260643;" x1="142.1209" x2="142.1209" y1="338.5578" y2="353.4786"/><polygon fill="#181818" points="139.1367,346.0182,142.1209,353.4786,145.1051,346.0182,142.1209,349.0024" style="stroke:#181818;stroke-width:0.7460413907260643;"/><line style="stroke:#181818;stroke-width:0.7460413907260643;" x1="142.1209" x2="142.1209" y1="378.9431" y2="393.864"/><polygon fill="#181818" points="139.1367,386.4035,142.1209,393.864,145.1051,386.4035,142.1209,389.3877" style="stroke:#181818;stroke-width:0.7460413907260643;"/><line style="stroke:#181818;stroke-width:0.7460413907260643;" x1="142.1209" x2="142.1209" y1="294.8321" y2="313.0933"/><polygon fill="#181818" points="139.1367,305.6329,142.1209,313.0933,145.1051,305.6329,142.1209,308.6171" style="stroke:#181818;stroke-width:0.7460413907260643;"/><line style="stroke:#181818;stroke-width:0.7460413907260643;" x1="167.8593" x2="283.4957" y1="285.8796" y2="285.8796"/><line style="stroke:#181818;stroke-width:0.7460413907260643;" x1="283.4957" x2="283.4957" y1="285.8796" y2="446.285"/><polygon fill="#181818" points="280.5116,438.8246,283.4957,446.285,286.4799,438.8246,283.4957,441.8088" style="stroke:#181818;stroke-width:0.7460413907260643;"/><line style="stroke:#181818;stroke-width:0.7460413907260643;" x1="283.4957" x2="142.1209" y1="446.285" y2="446.285"/><line style="stroke:#181818;stroke-width:0.7460413907260643;" x1="142.1209" x2="142.1209" y1="446.285" y2="450.0152"/><line style="stroke:#181818;stroke-width:0.7460413907260643;" x1="142.1209" x2="142.1209" y1="429.8721" y2="446.285"/><polygon fill="#181818" points="139.1367,438.8246,142.1209,446.285,145.1051,438.8246,142.1209,441.8088" style="stroke:#181818;stroke-width:0.7460413907260643;"/><line style="stroke:#181818;stroke-width:0.7460413907260643;" x1="142.1209" x2="142.1209" y1="262.0062" y2="276.9271"/><polygon fill="#181818" points="139.1367,269.4667,142.1209,276.9271,145.1051,269.4667,142.1209,272.4508" style="stroke:#181818;stroke-width:0.7460413907260643;"/><line style="stroke:#181818;stroke-width:0.7460413907260643;" x1="441.2835" x2="441.2835" y1="200.5336" y2="225.9981"/><polygon fill="#181818" points="438.2993,218.5377,441.2835,225.9981,444.2676,218.5377,441.2835,221.5218" style="stroke:#181818;stroke-width:0.7460413907260643;"/><line style="stroke:#181818;stroke-width:0.7460413907260643;" x1="441.2835" x2="441.2835" y1="262.0062" y2="276.9271"/><polygon fill="#181818" points="438.2993,269.4667,441.2835,276.9271,444.2676,269.4667,441.2835,272.4508" style="stroke:#181818;stroke-width:0.7460413907260643;"/><line style="stroke:#181818;stroke-width:0.7460413907260643;" x1="224.1854" x2="142.1209" y1="137.5689" y2="137.5689"/><line style="stroke:#181818;stroke-width:0.7460413907260643;" x1="142.1209" x2="142.1209" y1="137.5689" y2="153.9818"/><polygon fill="#181818" points="139.1367,146.5214,142.1209,153.9818,145.1051,146.5214,142.1209,149.5055" style="stroke:#181818;stroke-width:0.7460413907260643;"/><line style="stroke:#181818;stroke-width:0.7460413907260643;" x1="359.2189" x2="441.2835" y1="137.5689" y2="137.5689"/><line style="stroke:#181818;stroke-width:0.7460413907260643;" x1="441.2835" x2="441.2835" y1="137.5689" y2="153.9818"/><polygon fill="#181818" points="438.2993,146.5214,441.2835,153.9818,444.2676,146.5214,441.2835,149.5055" style="stroke:#181818;stroke-width:0.7460413907260643;"/><line style="stroke:#181818;stroke-width:0.7460413907260643;" x1="142.1209" x2="142.1209" y1="450.0152" y2="461.2058"/><polygon fill="#181818" points="139.1367,453.7454,142.1209,461.2058,145.1051,453.7454,142.1209,456.7296" style="stroke:#181818;stroke-width:0.7460413907260643;"/><line style="stroke:#181818;stroke-width:0.7460413907260643;" x1="441.2835" x2="441.2835" y1="312.9352" y2="461.2058"/><polygon fill="#181818" points="438.2993,453.7454,441.2835,461.2058,444.2676,453.7454,441.2835,456.7296" style="stroke:#181818;stroke-width:0.7460413907260643;"/><line style="stroke:#181818;stroke-width:0.7460413907260643;" x1="142.1209" x2="441.2835" y1="461.2058" y2="461.2058"/><line style="stroke:#181818;stroke-width:0.7460413907260643;" x1="291.7022" x2="291.7022" y1="113.6955" y2="128.6164"/><polygon fill="#181818" points="288.718,121.156,291.7022,128.6164,294.6863,121.156,291.7022,124.1401" style="stroke:#181818;stroke-width:0.7460413907260643;"/><line style="stroke:#181818;stroke-width:0.7460413907260643;" x1="291.7022" x2="291.7022" y1="461.2058" y2="476.1267"/><polygon fill="#181818" points="288.718,468.6663,291.7022,476.1267,294.6863,468.6663,291.7022,471.6504" style="stroke:#181818;stroke-width:0.7460413907260643;"/><!--MD5=[47da53329fff4719f63e5957e982879b]
@startuml FillChangesFlowEmployeeTopic
skinparam ConditionEndStyle hline 
scale max 500 height
    start
        :Получаем событие из кафки;
        :Запрашиваем из БД предыдущее состояние
        из таблицы employee_last_changes_raw;
        if (Предыдущее состояние есть) then (yes)
                :создаем обьект с полями prev_data и data
                наполняем prev_data данными 
                из поля data предыдущего сотояния
                а data наполняется данными из события;
                :построчно сравниваем prev_data и data;
                if (Есть Diff) then (yes)
                    :формируем diff;
                    :кладем его в таблицу employee_changes_raw;
                    :объект сохраняем в таблицу employee_last_changes_raw
                    с пометкой events_created = false;
                endif
               else
                :создаем обьект с полями prev_data и data
                prev_data будет пустым
                а data наполняется данными из события;
                :записываем в таблицу employee_changes_raw 
                новую строчку с полной информацией из ивента;
                :объект сохраняем в таблицу employee_last_changes_raw
                с пометкой events_created = false;
            endif
    stop
@enduml

PlantUML version 1.2022.7(Mon Aug 22 20:01:30 MSK 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: RU
--></g></svg>